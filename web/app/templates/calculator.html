<h2>計算機</h2>

<!-- 計算機框架容器 -->
<div
  style="
    width: 240px;
    padding: 10px;
    border: 2px solid #444;
    border-radius: 8px;
    background-color: #f9f9f9;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
  "
>
  <!-- 顯示區 -->
  <div style="margin-bottom: 10px">
    <div
      id="history"
      style="text-align: right; height: 20px; font-size: 0.9em; color: gray"
    ></div>
    <input
      type="text"
      id="display"
      style="width: 100%; height: 40px; font-size: 1.2em; text-align: right"
      placeholder="輸入算式或使用按鈕"
      onkeydown="handleKey(event)"
    />
  </div>

  <!-- 按鈕區 -->
  <div
    id="buttons"
    style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px"
  >
    <button onclick="press('7')">7</button>
    <button onclick="press('8')">8</button>
    <button onclick="press('9')">9</button>
    <button onclick="press('+')">+</button>

    <button onclick="press('4')">4</button>
    <button onclick="press('5')">5</button>
    <button onclick="press('6')">6</button>
    <button onclick="press('-')">-</button>

    <button onclick="press('1')">1</button>
    <button onclick="press('2')">2</button>
    <button onclick="press('3')">3</button>
    <button onclick="press('*')">*</button>

    <button onclick="press('0')">0</button>
    <button onclick="press('.')">.</button>
    <button onclick="clearDisplay()">C</button>
    <button onclick="press('/')">/</button>

    <button onclick="calculate()" style="grid-column: span 4">=</button>
  </div>

  <p id="error" style="color: red"></p>
</div>

<!-- 回首頁按鈕 -->
<div style="margin-top: 10px; text-align: left">
  <a href="/" style="text-decoration: none">
    <button style="padding: 4px 12px; font-size: 0.95em">← 回首頁</button>
  </a>
</div>

<style>
  #buttons button {
    height: 40px;
    font-size: 1.1em;
    border: 1px solid #aaa;
    border-radius: 4px;
    background-color: #eee;
    cursor: pointer;
  }
  #buttons button:hover {
    background-color: #ddd;
  }
</style>

<script>
  function press(val) {
    document.getElementById("display").value += val;
  }

  function clearDisplay() {
    document.getElementById("display").value = "";
    document.getElementById("history").textContent = "";
    document.getElementById("error").textContent = "";
  }

  function calculate() {
    const expr = document.getElementById("display").value.trim();
    if (!expr) return;

    fetch("/calculate", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ expression: expr }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.result !== undefined) {
          document.getElementById("history").textContent = expr + " =";
          document.getElementById("display").value = data.result;
          document.getElementById("error").textContent = "";
        } else {
          document.getElementById("error").textContent = data.error;
          document.getElementById("history").textContent = "";
        }
      })
      .catch(() => {
        document.getElementById("error").textContent = "無法計算";
      });
  }

  function handleKey(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      calculate();
    }
  }
</script>
